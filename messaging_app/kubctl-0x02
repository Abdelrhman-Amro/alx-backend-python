#!/bin/bash

# Deploy the blue version
echo "Deploying the blue version..."
kubectl apply -f blue_deployment.yaml

# Deploy the green version
echo "Deploying the green version..."
kubectl apply -f green_deployment.yaml

# Check logs for the green version
echo "Checking logs for the green version..."
kubectl logs -l app=django-messaging-app-green

# Switch traffic to the green version
echo "Switching traffic to the green version..."
kubectl patch service django-messaging-app-service -p '{"spec":{"selector":{"app":"django-messaging-app-green"}}}'

# Verify the service is pointing to the green version
kubectl get service django-messaging-app-service -o jsonpath='{.spec.selector}'
